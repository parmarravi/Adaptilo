<!doctype html>
<html>

<head>

    <title>unquote</title>

    <meta name="viewport" 
    content="width=device-width, minimum-scale=1.0, initial-scale=1.0, user-scalable=yes">

    <script src="./components/platform/platform.js"></script>

    <link rel="import" href="./components/font-roboto/roboto.html">
    <link rel="import" href="./components/paper-input/paper-input.html">
    <link rel="import" href="./components/paper-dialog/paper-dialog.html">
    <link rel="import" href="./components/paper-dialog/paper-dialog-transition.html">
    <link rel="import" href="./components/paper-button/paper-button.html">
	<link rel="import" href="./components/paper-shadow/paper-shadow.html">

    <link rel="import" href="adaptilo-client-base.html">

    <style>
        html,body {
            height: 100%;
            margin: 0;
            background-color: #E5E5E5;
            font-family: 'RobotoDraft', sans-serif;
        }
        .container {
            width: 80%;
            margin: 50px auto;
        }
        paper-dialog {
            width: 50%;
            min-width: 430px;
        }

        p {
            margin-bottom: 0;
        }

        paper-dialog paper-button {
            font-weight: bold;
        }

        paper-button[autofocus] {
            color: #4285f4;
        }
		
		.card {
            background: #E5E5E5;
            width: 80%;
            height: 500px;
            position: relative;
            margin: 50px;
            border-radius: 2px;
			padding : 30px;
			margin-left: auto;
			margin-right: auto;
        }
        
        @media (min-width: 481px) {
            #tabs {
                width: 200px;
            }
            .container {
                width: 400px;
            }
        }
    </style>

</head>

<body unresolved>

        <paper-dialog id="connection-dialog" heading="Adaptilo Client Base" transition="paper-dialog-transition-center" opened autoCloseDisabled>
            <paper-input id="input-ip" floatinglabel label="Server ip" layout vertical></paper-input>
            <paper-input id="input-port" floatinglabel label="Server port" layout vertical></paper-input>
			<paper-input id="input-game" floatinglabel label="Game name" layout vertical></paper-input>
            <paper-button id="btn-connect" label="Connect" affirmative></paper-button>
        </paper-dialog>
		
		<div id="message-box" class="card" flex>
		    <paper-shadow id="shadow" z="0" animated></paper-shadow>
		    <p id="messages" style="overflow-y : auto; height : 500px;"></p>
		</div>

        <adaptilo-client-base 
            id="adaptilo-client-base"
            serverIp="192.168.1.29" 
            serverPort="8887" 
            gameRoom="simple_demo" 
            gameName="simple_demo" 
            createRoomIfNotExist>
        </adaptilo-client-base>

    <script type="text/javascript">      
        window.addEventListener('polymer-ready', function(e) {           
            
			/**
			 * Retrieve DOM object.
			 */
            var connectBtn = document.getElementById("btn-connect");            
            var adaptilo = document.getElementById("adaptilo-client-base");
			var connectionDialog = document.getElementById("connection-dialog");
			var inputIp = document.getElementById("input-ip");
			var inputPort = document.getElementById("input-port");
			var inputGame = document.getElementById("input-game");
			var messageBox = document.getElementById("message-box");
			var messages = document.getElementById("messages");
			var shadow = document.getElementById("shadow");
			
			/**
			 * Initialize input fields
			 */
			inputIp.value = adaptilo.serverIp;
			inputPort.value = adaptilo.serverPort;
			inputGame.value = adaptilo.gameName;

            adaptilo.addEventListener("adaptilo-client-connected", function(event){
				shadow.z = 3;
				messages.innerHTML  = messages.innerHTML  +"</br> <h1> Welcome </h1>";
				messages.innerHTML  = messages.innerHTML  +"</br> Connected to the room : "+adaptilo.gameRoom;
				messages.innerHTML  = messages.innerHTML  +"</br> Roles available in the room are : "+adaptilo.roles;
            });

            adaptilo.addEventListener("adaptilo-client-message-received",function(event){
				messages.innerHTML  = messages.innerHTML  +"</br> Message received : "+event.detail;
                // adaptilo.send("USER_INPUT",{'eventAction' : 'KEY_A', 'eventTimeStamp' : 1403207477362});
            });

            adaptilo.addEventListener("adaptilo-client-disconnected", function(event){
				shadow.z = 0;
				messages.innerHTML = "";
				connectionDialog.toggle();
            });

            adaptilo.addEventListener("adaptilo-client-error", function(event){
                console.log("adaptilo-client-error : " + event);
            });
            
            connectBtn.addEventListener("tap", function(event) {
			    
				/**
				 * Update adaptilo attributes to match values from input fields.
				 */
			    adaptilo.serverIp = inputIp.value;
				adaptilo.serverPort = inputPort.value;
				adaptilo.gameName = inputGame.value;
                adaptilo.connect();
                // TODO get the values from the input
            });
        });
    </script>

</body>

</html>
