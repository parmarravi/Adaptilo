<!DOCTYPE HTML>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <title>Adaptilo : Simple Demo</title>
        <link rel="stylesheet" href="css/reset.css"/>
        <link rel="stylesheet" href="css/main.css"/>
    </head>
    
    <body>
    
        <div id="fixed_header">        
            <h1>
                Adaptilo Simple Demo
            </h1>
        </div>
        
        <div id="roles_container" style="display:none;">
            <h1>Roles</h1>
        </div>
        
        <div class="block">
            <div class="card centered" id="connection_card">
            
                <div class="card_content">
                    
                    <table id="connection_settings">
                        <tr>
                            <td>
                                <label for="hostIp">Host Ip</label>
                            </td>
                            <td>
                                <input id="server_ip" name="server_ip" value="192.168.0.15">
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <label for="port">Port</label>
                            </td>
                            <td>
                                <input id="server_port" name="server_port" value="8887">
                            </td>
                        </tr>
						<tr>
                            <td>
                                <label for="port">Join Room</label>
                            </td>
                            <td>
                                <input id="join_room" name="join_room" value="">
                            </td>
                        </tr>
                    </table> 
                </div>
                
                <button id="connection_button" type="button" class="card_button">Connect</button>            
                
            </div>
        </div>
    
        <script src="http://code.jquery.com/jquery-1.11.0.min.js"></script>
        <script src="js/jquery.qrcode.min.js"></script>
        <script src="js/main.js"></script>
        
        <script type="text/javascript">
            $(function() {
                // the DOM is now fully loaded.   

                // Connection Button
                var connectionButton = $("#connection_button");                
                connectionButton.bind("click", function() {
                    toggleConnection();
                });
                
                // Game Room Input
                var inputGameRoom = $("#join_room");
                inputGameRoom.val(window.location.hash.substring(1));
                inputGameRoom.keyup(function(event){
                    window.location.hash = inputGameRoom.val();
                });
                
                var platformConfiguration = Adaptilo.Configuration.createDefault();  
                
                // Set the onConnected behavior
                platformConfiguration.onConnected = function(roles) {
                    console.log("onConnected");
                    console.log(roles);
                    connectionButton.html("Disconnect");
                    console.log(platform.gameRoom);
                    window.location.hash = platform.gameRoom;
                    $("#roles_container").show();
                };
                
                // Set the onDisconnected behavior
                platformConfiguration.onDisconnected = function() {
                    console.log("onDisconnected");
                    connectionButton.html("Connect");
                    $("#roles_container").hide();
                }
                
                // Create the platform
                var platform = new Adaptilo.Platform();
                
                var toggleConnection = function() {
                    if (platform.isConnected) {
                        platform.disconnect();
                    } else {
                        // Get the server ip given by the user
                        platformConfiguration.serverIp = $("#server_ip").val()
                        // Get the server port given by the user
                        platformConfiguration.serverPort = $("#server_port").val();
                        // Set the game name used by the server
                        platformConfiguration.gameName = "testGame";
                        // Set game room for joining an existed one
                        platformConfiguration.gameRoom = null;
                        if(inputGameRoom.val()){
                            platformConfiguration.gameRoom = inputGameRoom.val();
                        }
                        
                        // Use the configuration for the connection
                        platform.setConfiguration(platformConfiguration);
                        platform.connect();                   
                    }
                }; 
                
                var generateQrCode = function(role) {
                    var qrCodeTitle = $(document.createElement('h2'));
                    qrCodeTitle.html("&#8226; "+role);
                    $("#roles_container").append(qrCodeTitle);
                    
                    var id = "qr_code_"+role;
                    var qrCodeContainer = $(document.createElement('div'));                    
                    qrCodeContainer.attr("id", id);
                    $("#roles_container").append(qrCodeContainer);
                    qrCodeContainer.qrcode({
                        width: 220,
                        height: 220,
                        text : "http://www.google.fr"
                    });                    
                };                
                
            });     

            
        </script>
    </boby>
    
</html>
    